{"componentChunkName":"component---src-templates-blog-template-blog-template-tsx","path":"/blog/2020-08-16-youtube-mymix/","result":{"data":{"markdownRemark":{"html":"<p>Sharing your music taste with others is uneasy, as it is something intimate\nand personal. There is the fear of rejection, fear of criticism against your\ndevotion to your favorite singer.</p>\n<p>Yet, we disclose our music taste almost unconditionally with “someone” that\nwe have never met, never spoken to. By listening to songs using popular\nstreaming service, we are giving away our preferences. For me, I listen to\nsongs on YouTube. Each click I make, each song I listen to, each search I do,\nall give a little piece of my music palate away.</p>\n<blockquote>\n<h3>\n  There are at least two copies of my music taste: the one sitting in my\n  brain and <i>the one encoded in the YouTube algorithm</i>.\n  \n</h3>\n</blockquote>\n<p>Not gonna lie, YouTube does give me good recommendation and does a great job\nat finding similar songs within the genre that I like. There is a feature\ndedicated to this called <a href=\"https://support.google.com/youtube/answer/9011078?hl=en\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">YouTube\nMix</a>. It often shows\nup in the feed page as the playlist “My Mix”. It also comes up when you\nsearch for “my mix” in the search bar.</p>\n<div style=\"max-width: 300px; margin: 0 auto\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4987213853db83cebc56482996c76302/a805e/mymix.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 80.625%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAADVElEQVQ4y62SfUjUdxzHfzib55133um08tlz5tlON5cijc1wUiF2KBHlSjZl2clWtq6i0UgwhvPhTE/TU7nzZnrawxq4kSCJxOFAMQWZIPjMpuATiKL4gPDa3W+5FrG/1g9evL/v9wfe3y/8PkJvby9WayN2u52WlpZXaG5+yauzZmf2Eldms9kYGhpCyM09jyAIb4TCwkKES/kG0Si9fdm3P5AAv72EBofg7x+A21sy3N/2RnBXofBS4KdUofJSIpdJ8fCQIPX0FJFJpWJHSXEJQmVJPbGRaZxI0lFcVE6t4Rq2O2Zu3bpLdOQptNqzpCRk8s1neVzL+pzMYzmkHvmEsOAgotThqEOC0USEI9njjdFYhTDx/Dm/lN3hdHIGt6/cpOHiZUoMxZiKLFy4YuB0UhaPz5/F+KUew5kcLunzSUtJRh3oT9qnyeiOpxKyPxgPNykV5SaEPwZ+w9FgJis1F+NXF+iqr+ZB/ROetP7K/fYO7tW28dPXeXTVmfi5ogZ7UTWJmij2yr2Ii4om5ePDqMOCkEvk1NWaEaqufs+NeA1Neh0O4zm6716k+0E7nfcf8uxZN4NPn/L7w8f8OdBPu6WNupvFfKSNwU+hJPaAljMndcS9r0G6R/Z3YVdNKYboGCr1aXSWpfOtLoOaH0zos6+jz7lOZ3U1/c12+i0/UlVgQq3W8cF7WuQeXmhCIkiIPUR4UIjzp7hRaaxAaCi4TbxPDN9lpGPPP0l81AnSD6USpk4n82geA6ZSRjs6mHzUTnedjcQPz6E9oOEdhQpfTyW+MhVhQUHI3CWYyp2FNy5fFds1PgEkx0YQ7FyXUNU+5PJANKHvciwhjpTEwxxPOuLURA5GHsTHW4VU4lwXD0+8PGUoFQpxbcpKSxG+yM5+Y4tdUFCA0NfXh9Vipa21lXtNTVgsFqe3vFArjVYnjY3/YHV6y4v5Lq7MbDYzODiIMDs7y8zMDOPj46yurvJ/P2F4eJienh4cDgejo6Ps7OywtbXF5uamqLv8229sbLC+vv4arlyYn59nenoa10unpqbEs+u1IyMjoo6NjYn55OSkOJuYmGBlZYXt7e3XLnUhLC8vMzc3J7K4uCiqq3xpaQnXZQsLC6K6/G62trb2n4V/ARzdDmtUvRDCAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"mymix\" title=\"mymix\" src=\"/static/4987213853db83cebc56482996c76302/a805e/mymix.png\" srcset=\"/static/4987213853db83cebc56482996c76302/69538/mymix.png 160w,\n/static/4987213853db83cebc56482996c76302/72799/mymix.png 320w,\n/static/4987213853db83cebc56482996c76302/a805e/mymix.png 572w\" sizes=\"(max-width: 572px) 100vw, 572px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n</div>\n<p>This playlist is dynamic. It changes its recommendation based on your current\nmusic taste (on YouTube that the algorithm is aware of). To a certain extent,\nyou can think of it as a snapshot of your current music preferences. </p>\n<p>If you find this playlist enjoyable and don’t want to lose the list of songs,\nyou can always save it into a permanent playlist. You can share it with other\nif you want to!</p>\n<p>What if you want to share your <em>current</em> preference with others? You can’t\nsince you cannot share the forever mutating recommendation. You can spare the\neffort to store “My Mix” everyday, but that is way to troublesome…</p>\n<h3 id=\"following-the-github-profile-hype\" style=\"position:relative;\"><a href=\"#following-the-github-profile-hype\" aria-label=\"following the github profile hype permalink\" class=\"gatsby-remark-autolink-headers-a-tags before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Following the GitHub Profile Hype</h3>\n<p>It was the\n<a href=\"https://www.aboutmonica.com/blog/how-to-create-a-github-profile-readme/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">all</a>\n<a href=\"https://medium.com/@jasonganub/how-to-create-a-github-profile-readme-b0ac0f081568\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">that</a>\n<a href=\"https://docs.github.com/en/github/setting-up-and-managing-your-github-profile/about-your-profile\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub\nprofile</a>\n<a href=\"https://towardsdatascience.com/build-a-stunning-readme-for-your-github-profile-9b80434fe5d7\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hype</a>\nthat got me into thinking about my music preference. What if I shared my\nmusic taste on my github profile README? A completely automated GitHub Action\nthat lists the top 5 songs from “My Mix”. Technically, the list of songs doesn’t\ncome from me directly. I never put in any song manually. It is all what YouTube\nthinks I like.</p>\n<p>The first thing that came to my mind was the <a href=\"https://developers.google.com/youtube/v3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">YouTube Data\nAPI</a>. It should be using the\n<a href=\"https://developers.google.com/youtube/v3/docs/playlistItems\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">playlistitems</code>\nresource</a>. But\nto get a playlist, we need its ID. The playlist is dynamic, how do we get the\nID?</p>\n<p>Conveniently, the “My Mix” playlist has a special fixed ID: <code class=\"language-text\">RDMM</code>\n(<a href=\"https://webapps.stackexchange.com/a/116496\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">source</a>). But the issue is that\nthis ID is the same for everyone. How do I query for specifically “My\nMix” that YouTube generates for me?</p>\n<p>By reading through the API docs, I found that the <code class=\"language-text\">playlistitems</code> API\nfetches the playlist from the <strong>given channel</strong>, which means that the channel,\ntherefore the user, is identified by whoever invokes the API. To invoke the\nAPI for the user, we would need to obtain the oauth token. That is it, we just\nneed to do the following few steps:</p>\n<ol>\n<li>Obtain access to YouTube Data API</li>\n<li>Obtain user (myself) permission to access their data, therefore receiving\nits oauth token</li>\n<li>Call the API regularly and update my README</li>\n</ol>\n<p>Here is a little caveat: oauth token expires. Once it do, we would need to\nregain permission from the user (myself), which is a manual repetitive\nprocess. Luckily, oauth offers a way for us to regain permission after the\ncurrent token expires. There is something called refresh token, which is a\ntoken that enables us to obtain a new access token. Read more about it here:\n<a href=\"https://developers.google.com/identity/protocols/oauth2#basicsteps\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Using OAuth 2.0 to Access Google\nAPIs</a>.</p>\n<p>Therefore, our steps would become:</p>\n<ol>\n<li>Obtain access to YouTube Data API</li>\n<li>Obtain user (myself) permission to access their data, therefore receiving\na temporary oauth token</li>\n<li>Use the temporary oauth token to get a refresh token </li>\n<li>Call the API regularly and update my README</li>\n</ol>\n<h3 id=\"tutorial\" style=\"position:relative;\"><a href=\"#tutorial\" aria-label=\"tutorial permalink\" class=\"gatsby-remark-autolink-headers-a-tags before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tutorial</h3>\n<h4 id=\"1-obtain-access-to-youtube-data-api\" style=\"position:relative;\"><a href=\"#1-obtain-access-to-youtube-data-api\" aria-label=\"1 obtain access to youtube data api permalink\" class=\"gatsby-remark-autolink-headers-a-tags before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Obtain access to YouTube Data API</h4>\n<p>Follow the step 1-3 listed on the guide: <a href=\"https://developers.google.com/youtube/v3/getting-started\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">YouTube Data API\nOverview</a>.</p>\n<p>After enabling access to the YouTube Data API, head to the tab ”<em>OAuth\nconsent screen</em>“create an external OAuth consent screen. 1) Fill in an\nApplication name. 2) Add the scope of <code class=\"language-text\">youtube.readonly</code>. You do not need to\nsubmit it for verification, since you would be the only one using this API.\nJust go ahead and click save.</p>\n<p>Now, go to the ”<em>Credentials</em>” tab in your project. Create an ”<em>OAuth client\nID</em>” with the application type being desktop app (in fact, it does not\nmatter). Now, you should be able to down load a client secret JSON file. The\nfile should look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"installed\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"client_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1234567-abcdefgh123.apps.googleusercontent.com\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"project_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lofty-gravity-12345\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"auth_uri\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://accounts.google.com/o/oauth2/auth\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"token_uri\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://oauth2.googleapis.com/token\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"auth_provider_x509_cert_url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://www.googleapis.com/oauth2/v1/certs\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"client_secret\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A_fej13kjov93jP_\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"redirect_uris\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"urn:ietf:wg:oauth:2.0:oob\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"http://localhost\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This file contains the <code class=\"language-text\">client_secret</code>, which lets Google API to identify\nwhich app project is using it.</p>\n<h4 id=\"2-obtain-user-permission-and-user-oauth-token\" style=\"position:relative;\"><a href=\"#2-obtain-user-permission-and-user-oauth-token\" aria-label=\"2 obtain user permission and user oauth token permalink\" class=\"gatsby-remark-autolink-headers-a-tags before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Obtain user permission and user oauth token</h4>\n<p>Directly working with the oauth workflow is difficult and hard to understand.\nTherefore, I have written a Python script that automates the process. Go\nahead and clone the repo\n<a href=\"https://github.com/GalenWong/fetch-youtube-oauth-token\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GalenWong/fetch-youtube-oauth-token</a>.</p>\n<p>The README of the repo should walk you through how to install it. To invoke\nthe script, you have to pass it the path to the client secret JSON file that\nwas obtained in step one.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">python fetch-token.py path/to/client-secret.json</code></pre></div>\n<blockquote>\n<p>Note: <strong>Don’t trust my script!</strong> Go ahead and read it and make sure you\nunderstand what it is doing. The script consumes your secret so be\ncareful with it!</p>\n</blockquote>\n<p>A link will be outputted. Go to that link and it would be a Google account\nlog in page. After log in, you would see the oauth consent screen asking you\nfor read access to your YouTube account. It would warn you about the fact\nthat it is not verified and there might be security concern. Since you are\nthe one who created the project and you are the only one using it, go ahead\nto click confirm. </p>\n<p>Now it should take you to a new page, with a text showing you a token. The\ntoken is your oauth token. It enables access to the YouTube data API.\nHowever, it is temporary and will expire within a day or so.</p>\n<h4 id=\"3-use-the-temporary-oauth-token-to-get-a-refresh-token\" style=\"position:relative;\"><a href=\"#3-use-the-temporary-oauth-token-to-get-a-refresh-token\" aria-label=\"3 use the temporary oauth token to get a refresh token permalink\" class=\"gatsby-remark-autolink-headers-a-tags before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Use the temporary oauth token to get a refresh token</h4>\n<p>After obtaining the oauth token, copy and paste it back to the script. The\nscript is still waiting for an input. After that, a file named\n<code class=\"language-text\">credentials.json</code> will be generated and it looks something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"token\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ya29.somereallylong-client-token\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"refresh_token\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1//a0Ab-Afasdfonfi-adfawf-M\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"token_uri\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://oauth2.googleapis.com/token\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"client_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"some-client-id.apps.googleusercontent.com\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"client_secret\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"SomeClientSecret123-Ab_C\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice that we now have a <code class=\"language-text\">refresh_token</code>. </p>\n<h4 id=\"4-call-the-api-regularly-and-update-the-readme\" style=\"position:relative;\"><a href=\"#4-call-the-api-regularly-and-update-the-readme\" aria-label=\"4 call the api regularly and update the readme permalink\" class=\"gatsby-remark-autolink-headers-a-tags before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Call the API regularly and update the README</h4>\n<p>To call the API regularly, we can use GitHub Action. It has an option to\nconfigure it to run as a cron job. The YAML configuration looks something\nlike this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update README with YouTube My Mix\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cron</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'0 * * * *'</span> <span class=\"token comment\"># runs every hour</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">update-readme</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update the profile README\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Python\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>python@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">python-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3.8</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/cache@v2\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Configure pip caching\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ~/.cache/pip\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> runner.os <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>pip<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> hashFiles('<span class=\"token important\">**/requirements.txt')</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">restore-keys</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ${{ runner.os }}-pip-</span></code></pre></div>\n<p>We have a few steps in the action already. We checkout the repo, set up\npython so that it is available, also set up pip caching so that dependency\ninstallation would be faster.</p>\n<p>Now let’s write the script. The script needs a few dependencies. Create\na <code class=\"language-text\">requirements.txt</code> file to specify them:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">google-api-python-client\ngoogle-auth\ngoogle-auth-oauthlib\ngoogle-auth-httplib2</code></pre></div>\n<p>In the script import the required modules:</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token comment\"># write_youtube_mymix.py</span>\n<span class=\"token keyword\">from</span> googleapiclient<span class=\"token punctuation\">.</span>discovery <span class=\"token keyword\">import</span> build\n<span class=\"token keyword\">import</span> google<span class=\"token punctuation\">.</span>oauth2<span class=\"token punctuation\">.</span>credentials\n<span class=\"token keyword\">import</span> os</code></pre></div>\n<p>Let’s assume that we have access to the tokens through the environment\nvariables. We will first access them through <code class=\"language-text\">os.environ</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token comment\"># write_youtube_mymix.py</span>\nTOKEN <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'TOKEN'</span><span class=\"token punctuation\">]</span>\nREFRESH_TOKEN <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'REFRESH_TOKEN'</span><span class=\"token punctuation\">]</span>\nCLIENT_ID <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'CLIENT_ID'</span><span class=\"token punctuation\">]</span>\nCLIENT_SECRET <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'CLIENT_SECRET'</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>We will create a Google oauth credential object from those tokens:</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token comment\"># write_youtube_mymix.py</span>\ncredentials <span class=\"token operator\">=</span> google<span class=\"token punctuation\">.</span>oauth2<span class=\"token punctuation\">.</span>credentials<span class=\"token punctuation\">.</span>Credentials<span class=\"token punctuation\">(</span>\n    token_uri<span class=\"token operator\">=</span><span class=\"token string\">'https://oauth2.googleapis.com/token'</span><span class=\"token punctuation\">,</span>\n    token<span class=\"token operator\">=</span>TOKEN<span class=\"token punctuation\">,</span> \n    refresh_token<span class=\"token operator\">=</span>REFRESH_TOKEN<span class=\"token punctuation\">,</span>\n    client_id<span class=\"token operator\">=</span>CLIENT_ID<span class=\"token punctuation\">,</span>\n    client_secret<span class=\"token operator\">=</span>CLIENT_SECRET<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then, we initialize an YouTube API client using the credentials and fetch\nthe data:</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token comment\"># write_youtube_mymix.py</span>\nyoutube <span class=\"token operator\">=</span> build<span class=\"token punctuation\">(</span><span class=\"token string\">'youtube'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'v3'</span><span class=\"token punctuation\">,</span> credentials<span class=\"token operator\">=</span>credentials<span class=\"token punctuation\">)</span>\n\nresp <span class=\"token operator\">=</span> youtube<span class=\"token punctuation\">.</span>playlistItems<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>\n                                part<span class=\"token operator\">=</span><span class=\"token string\">'snippet'</span><span class=\"token punctuation\">,</span> \n                                maxResults<span class=\"token operator\">=</span><span class=\"token number\">25</span><span class=\"token punctuation\">,</span> \n                                playlistId<span class=\"token operator\">=</span><span class=\"token string\">'RDMM'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>To make the query, we specify the <code class=\"language-text\">playlistId</code> as <code class=\"language-text\">RDMM</code>. The <code class=\"language-text\">part</code> means\nwhich fields we want to get. Using <code class=\"language-text\">snippet</code> indicates we are fetching\neverything.</p>\n<p>Now the <code class=\"language-text\">resp</code> variable is an dictionary containing our playlist. To see what\nit looks like exactly, play with the <a href=\"https://developers.google.com/youtube/v3/docs/playlistItems/list\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">YouTube API\nexplorer</a>.</p>\n<p>Now we transform the data into a list containing dictionaries with <code class=\"language-text\">name</code>\nand <code class=\"language-text\">link</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token comment\"># write_youtube_mymix.py</span>\nvideos <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> video_item <span class=\"token keyword\">in</span> resp<span class=\"token punctuation\">[</span><span class=\"token string\">'items'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n    name <span class=\"token operator\">=</span> video_item<span class=\"token punctuation\">[</span><span class=\"token string\">'snippet'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">]</span>\n    video_id <span class=\"token operator\">=</span> video_item<span class=\"token punctuation\">[</span><span class=\"token string\">'snippet'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'resourceId'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'videoId'</span><span class=\"token punctuation\">]</span>\n    link <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f'https://www.youtube.com/watch?v=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>video_id<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span>\n\n    videos<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> name<span class=\"token punctuation\">,</span> <span class=\"token string\">'link'</span><span class=\"token punctuation\">:</span> link <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now you can do whatever you want with it. Transform it into a markdown list\nand inject it into the markdown file. Go ahead see my full script here:\n<a href=\"https://github.com/GalenWong/GalenWong/blob/054d213b02c5048933e4c3750ada2b17fdbd5bde/write_youtube_mymix.py\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">write<em>youtube</em>mymix.py</a></p>\n<h4 id=\"accessing-the-oauth-token-and-secrets\" style=\"position:relative;\"><a href=\"#accessing-the-oauth-token-and-secrets\" aria-label=\"accessing the oauth token and secrets permalink\" class=\"gatsby-remark-autolink-headers-a-tags before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Accessing the oauth token and secrets</h4>\n<p>We would need to access the secret. <strong>Do not commit the <code class=\"language-text\">credentials.json</code>\nand the client secret JSON file in to the GitHub repo.</strong> As the names imply,\nthose are secret and uploading them to the web is a bad idea. Then, how would\nthe tokens be available in the Action then?</p>\n<p>GitHub offers a safe way for us to store secrets so that it is available in\nthe secret. Follow the steps here to upload the secrets: <a href=\"https://docs.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets#creating-encrypted-secrets-for-a-repository\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Creating encrypted\nsecrets for a\nrepository</a>.</p>\n<p>We would need to create 4 secrets from the <code class=\"language-text\">credentials.json</code> file. They are:</p>\n<ul>\n<li><code class=\"language-text\">token</code></li>\n<li><code class=\"language-text\">refresh_token</code></li>\n<li><code class=\"language-text\">client_id</code></li>\n<li><code class=\"language-text\">client_secret</code></li>\n</ul>\n<p>After we have created the secrets, we can access it in the GitHub workflow YAML\nfile. Since the script will access the secrets through environment variables,\nwe inject them in the workflow:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Write MyMix to README\n  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.YOUTUBE_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">REFRESH_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.YOUTUBE_REFRESH_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">CLIENT_ID</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.YOUTUBE_CLIENT_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">CLIENT_SECRET</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.YOUTUBE_CLIENT_SECRET <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    python write_youtube_mymix.py</span></code></pre></div>\n<p>I named the secrets with a <code class=\"language-text\">YOUTUBE_</code> prefix here and I named my script\n<code class=\"language-text\">write_youtube_mymix.py</code>. Note that you need to commit\n<code class=\"language-text\">write_youtube_mymix.py</code> script under the root directory of your project.</p>\n<p>Lastly, we need to commit and push the changes.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Commit and push\n  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    git diff\n    git config --global user.email \"your@email.com\"\n    git config --global user.name \"mymix-bot\"\n    git pull \n    git add -A \n    git commit -m \"Update YouTube Mymix\" || exit 0\n    git push</span></code></pre></div>\n<p>Note that if you set <code class=\"language-text\">user.email</code> to your GitHub email, it will show up on\nyour contributions. If you don’t want the bot to clutter up your contribution\nhistory graph, use a different email.</p>\n<p>Now, you have a script that fetches your custom YouTube song recommendation.\nAfter hooking it up to update your README, it can auto update!</p>\n<figure align=center>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7862257c914de309a636331996475516/28e7f/profile-demo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACwElEQVQ4y42TTYscVRSG+5dkmU022foL/AVZZyMEBRcuQkJUiCMoRIUkEMM4SCBOTFT8IjHoTjedkKjMTOIMTHdP90xPV1VXV9fH1OetW1WP51bPDBFRcuBwzz2c8573VL23kyUJs+mULE3J8hzf94miA1RZEoQhqeTzvGjzVVVhrGmaY3/RzLWji4IiicnTRBrzfxUZq6uaSldUdd16fehmQKE0SVaSFwqtNZ1YGPYHO1i2ze7emMnEYuq6WJbdxrbE/2da5gc5VIcUO4Ug2wLmeR6OM5XYaU8zYOrO6P25jvfXNjrJsFOftVmfME/QqmRjfY2d/jajYY+tzWcksmkL+NUvG6x895Rd2xfqBVGcEqcZqXy7oDdk/7fHRLbH5nyP+8Muk9Almnt8tPQm3Qer3L56mSuXzuHu9+nUQtObDHDG+2gBeFkrVMbPD1dYuvAGr5w+yReffSBZRUcWZ/2g4N5Ys7qludVr+NqCzweK1X7K988tvvxjl+VfbVa729x99JQk2KPMIj58/y1OnTzB2TOvcuPa28Tx3ADC7483uLH8LfdWvuHO1R9Y/vQB1967ya3rV7j/6CcernWFzYjNJ11mz29TD3+kOHBYuniOj8+/zt1P3uWdi68RRs5iZdIIQqEVTsV9mM/BCxBB/ufKlUgpdi2KwGVvNBAwl7KUlY2WHD9iZE0Z7ttEokUjAc1CCkfaGwyGrbzyPKOpq2O9Nv8QtsimaWqiVGEFJXagcMKSeazlpdRt+VFjmit6TsHEl7pQS51mNDN3RabMgIXYW0A/VjwbF+y4iuFMSaFiPC8Js+p4ei5NW1bBPKkI0opppPFksCFiYqWbQ4a1YVgKSNkC7XpyihtwA3pkqtQtQ5PzkwVgWtTkskmmanR1CLh4lw3m5xyfL/hi5aZ9s7MDLesuGCXFAoSjL9n21/wN0eQSfw4yx+wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"My Profile\"\n        title=\"My Profile\"\n        src=\"/static/7862257c914de309a636331996475516/6af66/profile-demo.png\"\n        srcset=\"/static/7862257c914de309a636331996475516/69538/profile-demo.png 160w,\n/static/7862257c914de309a636331996475516/72799/profile-demo.png 320w,\n/static/7862257c914de309a636331996475516/6af66/profile-demo.png 640w,\n/static/7862257c914de309a636331996475516/d9199/profile-demo.png 960w,\n/static/7862257c914de309a636331996475516/21b4d/profile-demo.png 1280w,\n/static/7862257c914de309a636331996475516/28e7f/profile-demo.png 1848w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<figcaption>\nThe \"Music\" section is where I show my encoded music taste in YouTube .\n</figcaption>\n</figure>\n<h2 id=\"into-the-future\" style=\"position:relative;\"><a href=\"#into-the-future\" aria-label=\"into the future permalink\" class=\"gatsby-remark-autolink-headers-a-tags before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Into the Future</h2>\n<p>My initial thought is to publish this as a custom reusable action, just like\nthe <a href=\"https://github.com/gautamkrishnar/blog-post-workflow\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">blog post\nworkflow</a> that auto\nupdates the docs. However, a large portion of the action is very boilerplate\ncode. For instance, installing Python, setting up pip cache, checking out the\nrepo, etc. I would like to reuse the other action as much as possible instead\nof writing redundant code. </p>\n<p>However, the GitHub Action does not currently support calling other Action\nwithin the custom Action. Therefore, the publishing of this YouTube MyMix\nfetch is blocked by this <a href=\"https://github.com/actions/runner/issues/646\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub\nissue</a>. Hopefully the GitHub\nteam can flush out the feature soon so I can publish this as a good Action\nwith less boilerplate code.</p>\n<p>At the mean time, please reference <a href=\"https://github.com/GalenWong/GalenWong\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">my GitHub profile\nrepo</a> for how to implement this! Feel\nfree to raise issues on that repo if you have any questions.</p>","frontmatter":{"date":"2020-08-16","title":"Seeing My Virtual Music Taste on Github Profile","subtitle":"A public display of my music taste encoded in the YouTube recommendation algorithm"},"timeToRead":11}},"pageContext":{"slug":"/2020-08-16-youtube-mymix/","next":{"title":"Galen Cooks Food the Wong Way","path":"/blog/2020-08-01-galen-cooks-food-the-wong-way/"}}}}